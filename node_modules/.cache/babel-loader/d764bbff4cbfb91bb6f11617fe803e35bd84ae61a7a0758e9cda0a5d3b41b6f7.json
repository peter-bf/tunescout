{"ast":null,"code":"import React,{useState,useEffect,useCallback,useRef}from'react';import{useQuery}from'react-query';import{getLastFmTopArtists}from'./API';import ArtistCard from'./ArtistCard';import ArtistModal from'./ArtistModal';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Artists=()=>{const[selectedArtist,setSelectedArtist]=useState(null);const[isModalVisible,setIsModalVisible]=useState(false);const modalRef=useRef(null);const lastFocusedElement=useRef(null);const[currentPage,setCurrentPage]=useState(1);const[currentArtists,setCurrentArtists]=useState([]);const artistsPerPage=10;const{data:artists,error,isLoading}=useQuery('topArtists',getLastFmTopArtists);const handleArtistClick=useCallback((artist,event)=>{lastFocusedElement.current=event.currentTarget;setSelectedArtist(artist);setIsModalVisible(true);},[]);const closePopup=useCallback(()=>{setIsModalVisible(false);setTimeout(()=>{setSelectedArtist(null);if(lastFocusedElement.current){lastFocusedElement.current.focus();}},300);},[]);useEffect(()=>{const handleClickOutside=event=>{if(modalRef.current&&!modalRef.current.contains(event.target)){closePopup();}};if(isModalVisible){document.addEventListener('mousedown',handleClickOutside);}else{document.removeEventListener('mousedown',handleClickOutside);}return()=>{document.removeEventListener('mousedown',handleClickOutside);};},[isModalVisible,closePopup]);useEffect(()=>{if(artists){const sortedArtists=[...artists].sort((a,b)=>b.popularity-a.popularity);const indexOfLastArtist=currentPage*artistsPerPage;const indexOfFirstArtist=indexOfLastArtist-artistsPerPage;setCurrentArtists(sortedArtists.slice(indexOfFirstArtist,indexOfLastArtist));}},[artists,currentPage]);if(error)return/*#__PURE__*/_jsx(\"p\",{className:\"text-red-500 text-center mt-4\",role:\"alert\",children:\"Failed to fetch top artists\"});if(isLoading)return/*#__PURE__*/_jsx(\"p\",{className:\"text-center mt-4\",role:\"status\",children:\"Loading...\"});const paginate=pageNumber=>{setCurrentArtists([]);// Clear current artists before updating the page\nsetCurrentPage(pageNumber);};const handlePreviousPage=()=>{if(currentPage>1)paginate(currentPage-1);};const handleNextPage=()=>{if(currentPage<Math.ceil(artists.length/artistsPerPage))paginate(currentPage+1);};return/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 mb-3\",children:[/*#__PURE__*/_jsx(\"header\",{children:/*#__PURE__*/_jsx(\"h1\",{className:\"text-5xl font-bold text-center mb-5 text-red-600 py-3\",id:\"top-artists-heading\",children:\"Top 50 Artists\"})}),/*#__PURE__*/_jsxs(\"main\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center\",children:/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-5 gap-6\",role:\"list\",\"aria-labelledby\":\"top-artists-heading\",children:currentArtists.map((artist,index)=>/*#__PURE__*/_jsx(ArtistCard,{artist:artist,index:(currentPage-1)*artistsPerPage+index,onClick:event=>handleArtistClick(artist,event),tabIndex:\"0\"// Make the artist card focusable\n,role:\"listitem\"},artist.id))})}),/*#__PURE__*/_jsxs(\"nav\",{\"aria-label\":\"Pagination\",className:\"flex justify-center mt-6\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:handlePreviousPage,className:\"px-4 py-2 mx-1 rounded \".concat(currentPage===1?'bg-gray-300 text-gray-500':'bg-white text-red-600'),disabled:currentPage===1,\"aria-label\":\"Previous Page\",children:\"Previous\"}),artists&&Array.from({length:Math.ceil(artists.length/artistsPerPage)},(_,i)=>/*#__PURE__*/_jsx(\"button\",{onClick:()=>paginate(i+1),className:\"px-4 py-2 mx-1 rounded \".concat(i+1===currentPage?'bg-red-600 text-white':'bg-white text-red-600'),\"aria-label\":\"Page \".concat(i+1),\"aria-current\":i+1===currentPage?'page':undefined,children:i+1},i+1)),/*#__PURE__*/_jsx(\"button\",{onClick:handleNextPage,className:\"px-4 py-2 mx-1 rounded \".concat(currentPage===Math.ceil(artists.length/artistsPerPage)?'bg-gray-300 text-gray-500':'bg-white text-red-600'),disabled:currentPage===Math.ceil(artists.length/artistsPerPage),\"aria-label\":\"Next Page\",children:\"Next\"})]})]}),selectedArtist&&/*#__PURE__*/_jsx(ArtistModal,{artist:selectedArtist,isVisible:isModalVisible,onClose:closePopup,modalRef:modalRef})]});};export default Artists;","map":{"version":3,"names":["React","useState","useEffect","useCallback","useRef","useQuery","getLastFmTopArtists","ArtistCard","ArtistModal","jsx","_jsx","jsxs","_jsxs","Artists","selectedArtist","setSelectedArtist","isModalVisible","setIsModalVisible","modalRef","lastFocusedElement","currentPage","setCurrentPage","currentArtists","setCurrentArtists","artistsPerPage","data","artists","error","isLoading","handleArtistClick","artist","event","current","currentTarget","closePopup","setTimeout","focus","handleClickOutside","contains","target","document","addEventListener","removeEventListener","sortedArtists","sort","a","b","popularity","indexOfLastArtist","indexOfFirstArtist","slice","className","role","children","paginate","pageNumber","handlePreviousPage","handleNextPage","Math","ceil","length","id","map","index","onClick","tabIndex","concat","disabled","Array","from","_","i","undefined","isVisible","onClose"],"sources":["/Users/peter/Documents/SUMMER 2024/SEG3125/tunescout/src/components/Artists.js"],"sourcesContent":["import React, { useState, useEffect, useCallback, useRef } from 'react';\nimport { useQuery } from 'react-query';\nimport { getLastFmTopArtists } from './API';\nimport ArtistCard from './ArtistCard';\nimport ArtistModal from './ArtistModal';\n\nconst Artists = () => {\n  const [selectedArtist, setSelectedArtist] = useState(null);\n  const [isModalVisible, setIsModalVisible] = useState(false);\n  const modalRef = useRef(null);\n  const lastFocusedElement = useRef(null);\n  const [currentPage, setCurrentPage] = useState(1);\n  const [currentArtists, setCurrentArtists] = useState([]);\n  const artistsPerPage = 10;\n\n  const { data: artists, error, isLoading } = useQuery('topArtists', getLastFmTopArtists);\n\n  const handleArtistClick = useCallback((artist, event) => {\n    lastFocusedElement.current = event.currentTarget;\n    setSelectedArtist(artist);\n    setIsModalVisible(true);\n  }, []);\n\n  const closePopup = useCallback(() => {\n    setIsModalVisible(false);\n    setTimeout(() => {\n      setSelectedArtist(null);\n      if (lastFocusedElement.current) {\n        lastFocusedElement.current.focus();\n      }\n    }, 300);\n  }, []);\n\n  useEffect(() => {\n    const handleClickOutside = (event) => {\n      if (modalRef.current && !modalRef.current.contains(event.target)) {\n        closePopup();\n      }\n    };\n\n    if (isModalVisible) {\n      document.addEventListener('mousedown', handleClickOutside);\n    } else {\n      document.removeEventListener('mousedown', handleClickOutside);\n    }\n\n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside);\n    };\n  }, [isModalVisible, closePopup]);\n\n  useEffect(() => {\n    if (artists) {\n      const sortedArtists = [...artists].sort((a, b) => b.popularity - a.popularity);\n      const indexOfLastArtist = currentPage * artistsPerPage;\n      const indexOfFirstArtist = indexOfLastArtist - artistsPerPage;\n      setCurrentArtists(sortedArtists.slice(indexOfFirstArtist, indexOfLastArtist));\n    }\n  }, [artists, currentPage]);\n\n  if (error) return <p className=\"text-red-500 text-center mt-4\" role=\"alert\">Failed to fetch top artists</p>;\n  if (isLoading) return <p className=\"text-center mt-4\" role=\"status\">Loading...</p>;\n\n  const paginate = (pageNumber) => {\n    setCurrentArtists([]); // Clear current artists before updating the page\n    setCurrentPage(pageNumber);\n  };\n\n  const handlePreviousPage = () => {\n    if (currentPage > 1) paginate(currentPage - 1);\n  };\n\n  const handleNextPage = () => {\n    if (currentPage < Math.ceil(artists.length / artistsPerPage)) paginate(currentPage + 1);\n  };\n\n  return (\n    <div className=\"p-4 mb-3\">\n      <header>\n        <h1 className=\"text-5xl font-bold text-center mb-5 text-red-600 py-3\" id=\"top-artists-heading\">Top 50 Artists</h1>\n      </header>\n      <main>\n        <div className=\"flex justify-center\">\n          <div className=\"grid grid-cols-5 gap-6\" role=\"list\" aria-labelledby=\"top-artists-heading\">\n            {currentArtists.map((artist, index) => (\n              <ArtistCard \n                key={artist.id} \n                artist={artist} \n                index={(currentPage - 1) * artistsPerPage + index} \n                onClick={(event) => handleArtistClick(artist, event)} \n                tabIndex=\"0\" // Make the artist card focusable\n                role=\"listitem\"\n              />\n            ))}\n          </div>\n        </div>\n        <nav aria-label=\"Pagination\" className=\"flex justify-center mt-6\">\n          <button\n            onClick={handlePreviousPage}\n            className={`px-4 py-2 mx-1 rounded ${currentPage === 1 ? 'bg-gray-300 text-gray-500' : 'bg-white text-red-600'}`}\n            disabled={currentPage === 1}\n            aria-label=\"Previous Page\"\n          >\n            Previous\n          </button>\n          {artists && Array.from({ length: Math.ceil(artists.length / artistsPerPage) }, (_, i) => (\n            <button\n              key={i + 1}\n              onClick={() => paginate(i + 1)}\n              className={`px-4 py-2 mx-1 rounded ${i + 1 === currentPage ? 'bg-red-600 text-white' : 'bg-white text-red-600'}`}\n              aria-label={`Page ${i + 1}`}\n              aria-current={i + 1 === currentPage ? 'page' : undefined}\n            >\n              {i + 1}\n            </button>\n          ))}\n          <button\n            onClick={handleNextPage}\n            className={`px-4 py-2 mx-1 rounded ${currentPage === Math.ceil(artists.length / artistsPerPage) ? 'bg-gray-300 text-gray-500' : 'bg-white text-red-600'}`}\n            disabled={currentPage === Math.ceil(artists.length / artistsPerPage)}\n            aria-label=\"Next Page\"\n          >\n            Next\n          </button>\n        </nav>\n      </main>\n      {selectedArtist && (\n        <ArtistModal \n          artist={selectedArtist} \n          isVisible={isModalVisible} \n          onClose={closePopup} \n          modalRef={modalRef} \n        />\n      )}\n    </div>\n  );\n};\n\nexport default Artists;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}