{"ast":null,"code":"import React,{useState,useEffect,useRef,useCallback}from'react';import{useQuery}from'react-query';import{getLastFmTopTracks,getLastFmTrackDetails,getLastFmArtistDetails,getLastFmTrackTags}from'./API';import TrackCard from'./TrackCard';import TrackTable from'./TrackTable';import TrackModal from'./TrackModal';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Trending=()=>{const[selectedTrack,setSelectedTrack]=useState(null);const[isModalVisible,setIsModalVisible]=useState(false);const modalRef=useRef(null);const{data:tracks,error,isLoading}=useQuery('topTracks',async()=>{const lastFmTracks=await getLastFmTopTracks();return Promise.all(lastFmTracks.map(async lastFmTrack=>{const trackDetails=await getLastFmTrackDetails(lastFmTrack.id);const tags=await getLastFmTrackTags(lastFmTrack.artist,lastFmTrack.name);return{...lastFmTrack,trackDetails,tags};}));});const handleTrackClick=useCallback(async track=>{setSelectedTrack(track);try{const artistDetails=await getLastFmArtistDetails(track.artist);setSelectedTrack(prev=>({...prev,artistDetails}));}catch(err){console.error('Failed to fetch artist details',err);}setIsModalVisible(true);},[]);const closePopup=useCallback(()=>{setIsModalVisible(false);setTimeout(()=>{setSelectedTrack(null);},300);},[]);useEffect(()=>{const handleClickOutside=event=>{if(modalRef.current&&!modalRef.current.contains(event.target)){closePopup();}};if(isModalVisible){document.addEventListener('mousedown',handleClickOutside);}else{document.removeEventListener('mousedown',handleClickOutside);}return()=>{document.removeEventListener('mousedown',handleClickOutside);};},[isModalVisible,closePopup]);if(error)return/*#__PURE__*/_jsx(\"p\",{className:\"text-red-500 text-center mt-4\",children:\"Failed to fetch top songs\"});if(isLoading)return/*#__PURE__*/_jsx(\"p\",{className:\"text-center mt-4\",children:\"Loading...\"});// Sort tracks by playcount\nconst sortedTracks=[...tracks].sort((a,b)=>b.playcount-a.playcount);const topSixTracks=sortedTracks.slice(0,6);const remainingTracks=sortedTracks.slice(6);return/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 mb-3\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-5xl font-bold text-center mb-5 text-red-600\",children:\"Trending\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-1/2 pr-4 grid grid-cols-3 gap-4\",style:{height:'700px'},children:topSixTracks.map((track,index)=>/*#__PURE__*/_jsx(TrackCard,{track:track,index:index,onClick:handleTrackClick},track.id||index))}),/*#__PURE__*/_jsx(\"div\",{className:\"w-1/2 pl-4\",style:{height:'700px'},children:/*#__PURE__*/_jsx(TrackTable,{tracks:remainingTracks,onClick:handleTrackClick})})]}),selectedTrack&&/*#__PURE__*/_jsx(TrackModal,{track:selectedTrack,isVisible:isModalVisible,onClose:closePopup,modalRef:modalRef})]});};export default/*#__PURE__*/React.memo(Trending);","map":{"version":3,"names":["React","useState","useEffect","useRef","useCallback","useQuery","getLastFmTopTracks","getLastFmTrackDetails","getLastFmArtistDetails","getLastFmTrackTags","TrackCard","TrackTable","TrackModal","jsx","_jsx","jsxs","_jsxs","Trending","selectedTrack","setSelectedTrack","isModalVisible","setIsModalVisible","modalRef","data","tracks","error","isLoading","lastFmTracks","Promise","all","map","lastFmTrack","trackDetails","id","tags","artist","name","handleTrackClick","track","artistDetails","prev","err","console","closePopup","setTimeout","handleClickOutside","event","current","contains","target","document","addEventListener","removeEventListener","className","children","sortedTracks","sort","a","b","playcount","topSixTracks","slice","remainingTracks","style","height","index","onClick","isVisible","onClose","memo"],"sources":["/Users/peter/Documents/SUMMER 2024/SEG3125/tunescout/src/components/Trending.js"],"sourcesContent":["import React, { useState, useEffect, useRef, useCallback } from 'react';\nimport { useQuery } from 'react-query';\nimport { getLastFmTopTracks, getLastFmTrackDetails, getLastFmArtistDetails, getLastFmTrackTags } from './API';\nimport TrackCard from './TrackCard';\nimport TrackTable from './TrackTable';\nimport TrackModal from './TrackModal';\n\nconst Trending = () => {\n  const [selectedTrack, setSelectedTrack] = useState(null);\n  const [isModalVisible, setIsModalVisible] = useState(false);\n  const modalRef = useRef(null);\n\n  const { data: tracks, error, isLoading } = useQuery('topTracks', async () => {\n    const lastFmTracks = await getLastFmTopTracks();\n    return Promise.all(\n      lastFmTracks.map(async (lastFmTrack) => {\n        const trackDetails = await getLastFmTrackDetails(lastFmTrack.id);\n        const tags = await getLastFmTrackTags(lastFmTrack.artist, lastFmTrack.name);\n        return { ...lastFmTrack, trackDetails, tags };\n      })\n    );\n  });\n\n  const handleTrackClick = useCallback(async (track) => {\n    setSelectedTrack(track);\n    try {\n      const artistDetails = await getLastFmArtistDetails(track.artist);\n      setSelectedTrack((prev) => ({ ...prev, artistDetails }));\n    } catch (err) {\n      console.error('Failed to fetch artist details', err);\n    }\n    setIsModalVisible(true);\n  }, []);\n\n  const closePopup = useCallback(() => {\n    setIsModalVisible(false);\n    setTimeout(() => {\n      setSelectedTrack(null);\n    }, 300);\n  }, []);\n\n  useEffect(() => {\n    const handleClickOutside = (event) => {\n      if (modalRef.current && !modalRef.current.contains(event.target)) {\n        closePopup();\n      }\n    };\n\n    if (isModalVisible) {\n      document.addEventListener('mousedown', handleClickOutside);\n    } else {\n      document.removeEventListener('mousedown', handleClickOutside);\n    }\n\n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside);\n    };\n  }, [isModalVisible, closePopup]);\n\n  if (error) return <p className=\"text-red-500 text-center mt-4\">Failed to fetch top songs</p>;\n  if (isLoading) return <p className=\"text-center mt-4\">Loading...</p>;\n\n  // Sort tracks by playcount\n  const sortedTracks = [...tracks].sort((a, b) => b.playcount - a.playcount);\n\n  const topSixTracks = sortedTracks.slice(0, 6);\n  const remainingTracks = sortedTracks.slice(6);\n\n  return (\n    <div className=\"p-4 mb-3\">\n      <h1 className=\"text-5xl font-bold text-center mb-5 text-red-600\">Trending</h1>\n      <div className=\"flex\">\n        <div className=\"w-1/2 pr-4 grid grid-cols-3 gap-4\" style={{ height: '700px' }}>\n          {topSixTracks.map((track, index) => (\n            <TrackCard key={track.id || index} track={track} index={index} onClick={handleTrackClick} />\n          ))}\n        </div>\n        <div className=\"w-1/2 pl-4\" style={{ height: '700px' }}>\n          <TrackTable tracks={remainingTracks} onClick={handleTrackClick} />\n        </div>\n      </div>\n\n      {selectedTrack && <TrackModal track={selectedTrack} isVisible={isModalVisible} onClose={closePopup} modalRef={modalRef} />}\n    </div>\n  );\n};\n\nexport default React.memo(Trending);"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,SAAS,CAAEC,MAAM,CAAEC,WAAW,KAAQ,OAAO,CACvE,OAASC,QAAQ,KAAQ,aAAa,CACtC,OAASC,kBAAkB,CAAEC,qBAAqB,CAAEC,sBAAsB,CAAEC,kBAAkB,KAAQ,OAAO,CAC7G,MAAO,CAAAC,SAAS,KAAM,aAAa,CACnC,MAAO,CAAAC,UAAU,KAAM,cAAc,CACrC,MAAO,CAAAC,UAAU,KAAM,cAAc,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAEtC,KAAM,CAAAC,QAAQ,CAAGA,CAAA,GAAM,CACrB,KAAM,CAACC,aAAa,CAAEC,gBAAgB,CAAC,CAAGlB,QAAQ,CAAC,IAAI,CAAC,CACxD,KAAM,CAACmB,cAAc,CAAEC,iBAAiB,CAAC,CAAGpB,QAAQ,CAAC,KAAK,CAAC,CAC3D,KAAM,CAAAqB,QAAQ,CAAGnB,MAAM,CAAC,IAAI,CAAC,CAE7B,KAAM,CAAEoB,IAAI,CAAEC,MAAM,CAAEC,KAAK,CAAEC,SAAU,CAAC,CAAGrB,QAAQ,CAAC,WAAW,CAAE,SAAY,CAC3E,KAAM,CAAAsB,YAAY,CAAG,KAAM,CAAArB,kBAAkB,CAAC,CAAC,CAC/C,MAAO,CAAAsB,OAAO,CAACC,GAAG,CAChBF,YAAY,CAACG,GAAG,CAAC,KAAO,CAAAC,WAAW,EAAK,CACtC,KAAM,CAAAC,YAAY,CAAG,KAAM,CAAAzB,qBAAqB,CAACwB,WAAW,CAACE,EAAE,CAAC,CAChE,KAAM,CAAAC,IAAI,CAAG,KAAM,CAAAzB,kBAAkB,CAACsB,WAAW,CAACI,MAAM,CAAEJ,WAAW,CAACK,IAAI,CAAC,CAC3E,MAAO,CAAE,GAAGL,WAAW,CAAEC,YAAY,CAAEE,IAAK,CAAC,CAC/C,CAAC,CACH,CAAC,CACH,CAAC,CAAC,CAEF,KAAM,CAAAG,gBAAgB,CAAGjC,WAAW,CAAC,KAAO,CAAAkC,KAAK,EAAK,CACpDnB,gBAAgB,CAACmB,KAAK,CAAC,CACvB,GAAI,CACF,KAAM,CAAAC,aAAa,CAAG,KAAM,CAAA/B,sBAAsB,CAAC8B,KAAK,CAACH,MAAM,CAAC,CAChEhB,gBAAgB,CAAEqB,IAAI,GAAM,CAAE,GAAGA,IAAI,CAAED,aAAc,CAAC,CAAC,CAAC,CAC1D,CAAE,MAAOE,GAAG,CAAE,CACZC,OAAO,CAACjB,KAAK,CAAC,gCAAgC,CAAEgB,GAAG,CAAC,CACtD,CACApB,iBAAiB,CAAC,IAAI,CAAC,CACzB,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAsB,UAAU,CAAGvC,WAAW,CAAC,IAAM,CACnCiB,iBAAiB,CAAC,KAAK,CAAC,CACxBuB,UAAU,CAAC,IAAM,CACfzB,gBAAgB,CAAC,IAAI,CAAC,CACxB,CAAC,CAAE,GAAG,CAAC,CACT,CAAC,CAAE,EAAE,CAAC,CAENjB,SAAS,CAAC,IAAM,CACd,KAAM,CAAA2C,kBAAkB,CAAIC,KAAK,EAAK,CACpC,GAAIxB,QAAQ,CAACyB,OAAO,EAAI,CAACzB,QAAQ,CAACyB,OAAO,CAACC,QAAQ,CAACF,KAAK,CAACG,MAAM,CAAC,CAAE,CAChEN,UAAU,CAAC,CAAC,CACd,CACF,CAAC,CAED,GAAIvB,cAAc,CAAE,CAClB8B,QAAQ,CAACC,gBAAgB,CAAC,WAAW,CAAEN,kBAAkB,CAAC,CAC5D,CAAC,IAAM,CACLK,QAAQ,CAACE,mBAAmB,CAAC,WAAW,CAAEP,kBAAkB,CAAC,CAC/D,CAEA,MAAO,IAAM,CACXK,QAAQ,CAACE,mBAAmB,CAAC,WAAW,CAAEP,kBAAkB,CAAC,CAC/D,CAAC,CACH,CAAC,CAAE,CAACzB,cAAc,CAAEuB,UAAU,CAAC,CAAC,CAEhC,GAAIlB,KAAK,CAAE,mBAAOX,IAAA,MAAGuC,SAAS,CAAC,+BAA+B,CAAAC,QAAA,CAAC,2BAAyB,CAAG,CAAC,CAC5F,GAAI5B,SAAS,CAAE,mBAAOZ,IAAA,MAAGuC,SAAS,CAAC,kBAAkB,CAAAC,QAAA,CAAC,YAAU,CAAG,CAAC,CAEpE;AACA,KAAM,CAAAC,YAAY,CAAG,CAAC,GAAG/B,MAAM,CAAC,CAACgC,IAAI,CAAC,CAACC,CAAC,CAAEC,CAAC,GAAKA,CAAC,CAACC,SAAS,CAAGF,CAAC,CAACE,SAAS,CAAC,CAE1E,KAAM,CAAAC,YAAY,CAAGL,YAAY,CAACM,KAAK,CAAC,CAAC,CAAE,CAAC,CAAC,CAC7C,KAAM,CAAAC,eAAe,CAAGP,YAAY,CAACM,KAAK,CAAC,CAAC,CAAC,CAE7C,mBACE7C,KAAA,QAAKqC,SAAS,CAAC,UAAU,CAAAC,QAAA,eACvBxC,IAAA,OAAIuC,SAAS,CAAC,kDAAkD,CAAAC,QAAA,CAAC,UAAQ,CAAI,CAAC,cAC9EtC,KAAA,QAAKqC,SAAS,CAAC,MAAM,CAAAC,QAAA,eACnBxC,IAAA,QAAKuC,SAAS,CAAC,mCAAmC,CAACU,KAAK,CAAE,CAAEC,MAAM,CAAE,OAAQ,CAAE,CAAAV,QAAA,CAC3EM,YAAY,CAAC9B,GAAG,CAAC,CAACQ,KAAK,CAAE2B,KAAK,gBAC7BnD,IAAA,CAACJ,SAAS,EAAyB4B,KAAK,CAAEA,KAAM,CAAC2B,KAAK,CAAEA,KAAM,CAACC,OAAO,CAAE7B,gBAAiB,EAAzEC,KAAK,CAACL,EAAE,EAAIgC,KAA+D,CAC5F,CAAC,CACC,CAAC,cACNnD,IAAA,QAAKuC,SAAS,CAAC,YAAY,CAACU,KAAK,CAAE,CAAEC,MAAM,CAAE,OAAQ,CAAE,CAAAV,QAAA,cACrDxC,IAAA,CAACH,UAAU,EAACa,MAAM,CAAEsC,eAAgB,CAACI,OAAO,CAAE7B,gBAAiB,CAAE,CAAC,CAC/D,CAAC,EACH,CAAC,CAELnB,aAAa,eAAIJ,IAAA,CAACF,UAAU,EAAC0B,KAAK,CAAEpB,aAAc,CAACiD,SAAS,CAAE/C,cAAe,CAACgD,OAAO,CAAEzB,UAAW,CAACrB,QAAQ,CAAEA,QAAS,CAAE,CAAC,EACvH,CAAC,CAEV,CAAC,CAED,2BAAetB,KAAK,CAACqE,IAAI,CAACpD,QAAQ,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}