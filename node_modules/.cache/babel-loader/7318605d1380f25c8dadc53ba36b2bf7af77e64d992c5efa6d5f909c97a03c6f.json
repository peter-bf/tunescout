{"ast":null,"code":"import React,{useState,useEffect,useRef,useCallback}from'react';import{useQuery}from'react-query';import{getSpotifyTopTracks,getLastFmStreams,getTrackDetails,getArtistDetails}from'./API';import TrackCard from'./TrackCard';import TrackTable from'./TrackTable';import TrackModal from'./TrackModal';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Trending=()=>{const[selectedTrack,setSelectedTrack]=useState(null);const[isModalVisible,setIsModalVisible]=useState(false);const modalRef=useRef(null);const{data:tracks,error,isLoading}=useQuery('topTracks',async()=>{const spotifyTracks=await getSpotifyTopTracks();return Promise.all(spotifyTracks.map(async spotifyTrack=>{const playcount=await getLastFmStreams(spotifyTrack.name,spotifyTrack.artist);const trackDetails=await getTrackDetails(spotifyTrack.id);return{...spotifyTrack,playcount,trackDetails};}));});const handleTrackClick=useCallback(async track=>{setSelectedTrack(track);try{const artistDetails=await getArtistDetails(track.artistId);setSelectedTrack(prev=>({...prev,artistDetails}));}catch(err){console.error('Failed to fetch artist details',err);}setIsModalVisible(true);},[]);const closePopup=useCallback(()=>{setIsModalVisible(false);setTimeout(()=>{setSelectedTrack(null);},300);},[]);useEffect(()=>{const handleClickOutside=event=>{if(modalRef.current&&!modalRef.current.contains(event.target)){closePopup();}};if(isModalVisible){document.addEventListener('mousedown',handleClickOutside);}else{document.removeEventListener('mousedown',handleClickOutside);}return()=>{document.removeEventListener('mousedown',handleClickOutside);};},[isModalVisible,closePopup]);if(error)return/*#__PURE__*/_jsx(\"p\",{className:\"text-red-500 text-center mt-4\",children:\"Failed to fetch top songs\"});if(isLoading)return/*#__PURE__*/_jsx(\"p\",{className:\"text-center mt-4\",children:\"Loading...\"});// Sort tracks by popularity first, then by streams\nconst sortedTracks=[...tracks].sort((a,b)=>{var _b$trackDetails,_a$trackDetails,_b$trackDetails2,_a$trackDetails2;if(((_b$trackDetails=b.trackDetails)===null||_b$trackDetails===void 0?void 0:_b$trackDetails.popularity)===((_a$trackDetails=a.trackDetails)===null||_a$trackDetails===void 0?void 0:_a$trackDetails.popularity)){return b.playcount-a.playcount;}return((_b$trackDetails2=b.trackDetails)===null||_b$trackDetails2===void 0?void 0:_b$trackDetails2.popularity)-((_a$trackDetails2=a.trackDetails)===null||_a$trackDetails2===void 0?void 0:_a$trackDetails2.popularity);});const topSixTracks=sortedTracks.slice(0,6);const remainingTracks=sortedTracks.slice(6);return/*#__PURE__*/_jsxs(\"div\",{className:\"p-4\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-5xl font-bold text-center mb-4 text-red-600\",children:\"Trending\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-1/2 pr-4 grid grid-cols-3 gap-4\",style:{height:'710px'},children:topSixTracks.map((track,index)=>/*#__PURE__*/_jsx(TrackCard,{track:track,index:index,onClick:handleTrackClick},track.id))}),/*#__PURE__*/_jsx(\"div\",{className:\"w-1/2 pl-4\",style:{height:'710px'},children:/*#__PURE__*/_jsx(TrackTable,{tracks:remainingTracks,onClick:handleTrackClick})})]}),selectedTrack&&/*#__PURE__*/_jsx(TrackModal,{track:selectedTrack,isVisible:isModalVisible,onClose:closePopup,modalRef:modalRef})]});};export default/*#__PURE__*/React.memo(Trending);","map":{"version":3,"names":["React","useState","useEffect","useRef","useCallback","useQuery","getSpotifyTopTracks","getLastFmStreams","getTrackDetails","getArtistDetails","TrackCard","TrackTable","TrackModal","jsx","_jsx","jsxs","_jsxs","Trending","selectedTrack","setSelectedTrack","isModalVisible","setIsModalVisible","modalRef","data","tracks","error","isLoading","spotifyTracks","Promise","all","map","spotifyTrack","playcount","name","artist","trackDetails","id","handleTrackClick","track","artistDetails","artistId","prev","err","console","closePopup","setTimeout","handleClickOutside","event","current","contains","target","document","addEventListener","removeEventListener","className","children","sortedTracks","sort","a","b","_b$trackDetails","_a$trackDetails","_b$trackDetails2","_a$trackDetails2","popularity","topSixTracks","slice","remainingTracks","style","height","index","onClick","isVisible","onClose","memo"],"sources":["/Users/peter/Documents/SUMMER 2024/SEG3125/tunescout/src/components/Trending.js"],"sourcesContent":["import React, { useState, useEffect, useRef, useCallback } from 'react';\nimport { useQuery } from 'react-query';\nimport { getSpotifyTopTracks, getLastFmStreams, getTrackDetails, getArtistDetails } from './API';\nimport TrackCard from './TrackCard';\nimport TrackTable from './TrackTable';\nimport TrackModal from './TrackModal';\n\nconst Trending = () => {\n  const [selectedTrack, setSelectedTrack] = useState(null);\n  const [isModalVisible, setIsModalVisible] = useState(false);\n  const modalRef = useRef(null);\n\n  const { data: tracks, error, isLoading } = useQuery('topTracks', async () => {\n    const spotifyTracks = await getSpotifyTopTracks();\n    return Promise.all(\n      spotifyTracks.map(async (spotifyTrack) => {\n        const playcount = await getLastFmStreams(spotifyTrack.name, spotifyTrack.artist);\n        const trackDetails = await getTrackDetails(spotifyTrack.id);\n        return { ...spotifyTrack, playcount, trackDetails };\n      })\n    );\n  });\n\n  const handleTrackClick = useCallback(async (track) => {\n    setSelectedTrack(track);\n    try {\n      const artistDetails = await getArtistDetails(track.artistId);\n      setSelectedTrack((prev) => ({ ...prev, artistDetails }));\n    } catch (err) {\n      console.error('Failed to fetch artist details', err);\n    }\n    setIsModalVisible(true);\n  }, []);\n\n  const closePopup = useCallback(() => {\n    setIsModalVisible(false);\n    setTimeout(() => {\n      setSelectedTrack(null);\n    }, 300);\n  }, []);\n\n  useEffect(() => {\n    const handleClickOutside = (event) => {\n      if (modalRef.current && !modalRef.current.contains(event.target)) {\n        closePopup();\n      }\n    };\n\n    if (isModalVisible) {\n      document.addEventListener('mousedown', handleClickOutside);\n    } else {\n      document.removeEventListener('mousedown', handleClickOutside);\n    }\n\n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside);\n    };\n  }, [isModalVisible, closePopup]);\n\n  if (error) return <p className=\"text-red-500 text-center mt-4\">Failed to fetch top songs</p>;\n  if (isLoading) return <p className=\"text-center mt-4\">Loading...</p>;\n\n  // Sort tracks by popularity first, then by streams\n  const sortedTracks = [...tracks].sort((a, b) => {\n    if (b.trackDetails?.popularity === a.trackDetails?.popularity) {\n      return b.playcount - a.playcount;\n    }\n    return b.trackDetails?.popularity - a.trackDetails?.popularity;\n  });\n\n  const topSixTracks = sortedTracks.slice(0, 6);\n  const remainingTracks = sortedTracks.slice(6);\n\n  return (\n    <div className=\"p-4\">\n      <h1 className=\"text-5xl font-bold text-center mb-4 text-red-600\">Trending</h1>\n      <div className=\"flex\">\n        <div className=\"w-1/2 pr-4 grid grid-cols-3 gap-4\" style={{ height: '710px' }}>\n          {topSixTracks.map((track, index) => (\n            <TrackCard key={track.id} track={track} index={index} onClick={handleTrackClick} />\n          ))}\n        </div>\n        <div className=\"w-1/2 pl-4\" style={{ height: '710px' }}>\n          <TrackTable tracks={remainingTracks} onClick={handleTrackClick} />\n        </div>\n      </div>\n\n      {selectedTrack && <TrackModal track={selectedTrack} isVisible={isModalVisible} onClose={closePopup} modalRef={modalRef} />}\n    </div>\n  );\n};\n\nexport default React.memo(Trending);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}