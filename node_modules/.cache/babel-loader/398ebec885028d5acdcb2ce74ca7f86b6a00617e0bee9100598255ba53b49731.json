{"ast":null,"code":"import axios from 'axios';\nconst clientId = '7c6b8a3ea0e3406b9d8e5974be8b442b';\nconst clientSecret = '49aa02d0a85249279ae8ab73bbef28f5';\nconst lastFmApiKey = '28c425ac5fe3a7288e17efe8d7f9f82c';\nlet spotifyToken = null;\nlet tokenExpiry = null;\nconst lastFmCache = {};\nconst getSpotifyToken = async () => {\n  if (spotifyToken && tokenExpiry && tokenExpiry > Date.now()) {\n    return spotifyToken;\n  }\n  const response = await axios.post('https://accounts.spotify.com/api/token', null, {\n    headers: {\n      'Content-Type': 'application/x-www-form-urlencoded',\n      'Authorization': `Basic ${btoa(`${clientId}:${clientSecret}`)}`\n    },\n    params: {\n      grant_type: 'client_credentials'\n    }\n  });\n  spotifyToken = response.data.access_token;\n  tokenExpiry = Date.now() + response.data.expires_in * 1000;\n  return spotifyToken;\n};\nconst getSpotifyTrackImages = async (trackName, artistName) => {\n  const token = await getSpotifyToken();\n  const response = await axios.get('https://api.spotify.com/v1/search', {\n    headers: {\n      'Authorization': `Bearer ${token}`\n    },\n    params: {\n      q: `track:${trackName} artist:${artistName}`,\n      type: 'track',\n      limit: 1\n    }\n  });\n  if (response.data.tracks.items.length > 0) {\n    var _track$album$images$;\n    const track = response.data.tracks.items[0];\n    return ((_track$album$images$ = track.album.images[1]) === null || _track$album$images$ === void 0 ? void 0 : _track$album$images$.url) || '';\n  }\n  return '';\n};\nconst getLastFmTopTracks = async () => {\n  try {\n    const response = await axios.get('https://ws.audioscrobbler.com/2.0/', {\n      params: {\n        method: 'chart.gettoptracks',\n        api_key: lastFmApiKey,\n        format: 'json',\n        limit: 50\n      }\n    });\n    return Promise.all(response.data.tracks.track.map(async track => {\n      const image = await getSpotifyTrackImages(track.name, track.artist.name);\n      return {\n        id: track.mbid,\n        name: track.name,\n        artist: track.artist.name,\n        image,\n        playcount: track.playcount\n      };\n    }));\n  } catch (error) {\n    console.error('Failed to fetch Last.FM top tracks', error);\n    return [];\n  }\n};\nconst getLastFmTopArtists = async (limit = 50) => {\n  try {\n    const response = await axios.get('https://ws.audioscrobbler.com/2.0/', {\n      params: {\n        method: 'chart.gettopartists',\n        api_key: lastFmApiKey,\n        format: 'json',\n        limit\n      }\n    });\n    return response.data.artists.artist.map(artist => ({\n      id: artist.mbid,\n      name: artist.name,\n      genres: [],\n      // Last.FM doesn't provide genres in this call\n      followers: artist.listeners,\n      popularity: artist.playcount,\n      images: [{\n        url: artist.image[2]['#text']\n      }] // Using the medium-sized image\n    }));\n  } catch (error) {\n    console.error('Failed to fetch Last.FM top artists', error);\n    return [];\n  }\n};\nconst getLastFmTrackDetails = async trackId => {\n  try {\n    const response = await axios.get('https://ws.audioscrobbler.com/2.0/', {\n      params: {\n        method: 'track.getInfo',\n        api_key: lastFmApiKey,\n        mbid: trackId,\n        format: 'json'\n      }\n    });\n    return response.data.track;\n  } catch (error) {\n    console.error('Failed to fetch Last.FM track details', error);\n    return null;\n  }\n};\nconst getLastFmTrackTags = async (artist, track) => {\n  try {\n    const response = await axios.get('https://ws.audioscrobbler.com/2.0/', {\n      params: {\n        method: 'track.getTopTags',\n        api_key: lastFmApiKey,\n        artist: artist,\n        track: track,\n        format: 'json'\n      }\n    });\n    return response.data.toptags.tag.map(tag => tag.name);\n  } catch (error) {\n    console.error('Failed to fetch Last.FM track tags', error);\n    return [];\n  }\n};\nconst getLastFmArtistDetails = async artist => {\n  try {\n    const response = await axios.get('https://ws.audioscrobbler.com/2.0/', {\n      params: {\n        method: 'artist.getInfo',\n        api_key: lastFmApiKey,\n        artist: artist,\n        format: 'json'\n      }\n    });\n    const artistData = response.data.artist;\n    return {\n      ...artistData,\n      images: artistData.image.map(img => ({\n        url: img['#text']\n      }))\n    };\n  } catch (error) {\n    console.error('Failed to fetch Last.FM artist details', error);\n    return null;\n  }\n};\nexport { getLastFmTopTracks, getLastFmTopArtists, getLastFmTrackDetails, getLastFmArtistDetails, getLastFmTrackTags };","map":{"version":3,"names":["axios","clientId","clientSecret","lastFmApiKey","spotifyToken","tokenExpiry","lastFmCache","getSpotifyToken","Date","now","response","post","headers","btoa","params","grant_type","data","access_token","expires_in","getSpotifyTrackImages","trackName","artistName","token","get","q","type","limit","tracks","items","length","_track$album$images$","track","album","images","url","getLastFmTopTracks","method","api_key","format","Promise","all","map","image","name","artist","id","mbid","playcount","error","console","getLastFmTopArtists","artists","genres","followers","listeners","popularity","getLastFmTrackDetails","trackId","getLastFmTrackTags","toptags","tag","getLastFmArtistDetails","artistData","img"],"sources":["/Users/peter/Documents/SUMMER 2024/SEG3125/tunescout/src/components/API.js"],"sourcesContent":["import axios from 'axios';\n\nconst clientId = '7c6b8a3ea0e3406b9d8e5974be8b442b';\nconst clientSecret = '49aa02d0a85249279ae8ab73bbef28f5';\nconst lastFmApiKey = '28c425ac5fe3a7288e17efe8d7f9f82c';\n\nlet spotifyToken = null;\nlet tokenExpiry = null;\nconst lastFmCache = {};\n\nconst getSpotifyToken = async () => {\n  if (spotifyToken && tokenExpiry && tokenExpiry > Date.now()) {\n    return spotifyToken;\n  }\n\n  const response = await axios.post('https://accounts.spotify.com/api/token', null, {\n    headers: {\n      'Content-Type': 'application/x-www-form-urlencoded',\n      'Authorization': `Basic ${btoa(`${clientId}:${clientSecret}`)}`\n    },\n    params: {\n      grant_type: 'client_credentials'\n    }\n  });\n\n  spotifyToken = response.data.access_token;\n  tokenExpiry = Date.now() + response.data.expires_in * 1000;\n  return spotifyToken;\n};\n\nconst getSpotifyTrackImages = async (trackName, artistName) => {\n  const token = await getSpotifyToken();\n  const response = await axios.get('https://api.spotify.com/v1/search', {\n    headers: {\n      'Authorization': `Bearer ${token}`\n    },\n    params: {\n      q: `track:${trackName} artist:${artistName}`,\n      type: 'track',\n      limit: 1\n    }\n  });\n\n  if (response.data.tracks.items.length > 0) {\n    const track = response.data.tracks.items[0];\n    return track.album.images[1]?.url || '';\n  }\n\n  return '';\n};\n\nconst getLastFmTopTracks = async () => {\n  try {\n    const response = await axios.get('https://ws.audioscrobbler.com/2.0/', {\n      params: {\n        method: 'chart.gettoptracks',\n        api_key: lastFmApiKey,\n        format: 'json',\n        limit: 50\n      }\n    });\n    return Promise.all(response.data.tracks.track.map(async (track) => {\n      const image = await getSpotifyTrackImages(track.name, track.artist.name);\n      return {\n        id: track.mbid,\n        name: track.name,\n        artist: track.artist.name,\n        image,\n        playcount: track.playcount\n      };\n    }));\n  } catch (error) {\n    console.error('Failed to fetch Last.FM top tracks', error);\n    return [];\n  }\n};\n\nconst getLastFmTopArtists = async (limit = 50) => {\n  try {\n    const response = await axios.get('https://ws.audioscrobbler.com/2.0/', {\n      params: {\n        method: 'chart.gettopartists',\n        api_key: lastFmApiKey,\n        format: 'json',\n        limit\n      }\n    });\n    return response.data.artists.artist.map(artist => ({\n      id: artist.mbid,\n      name: artist.name,\n      genres: [], // Last.FM doesn't provide genres in this call\n      followers: artist.listeners,\n      popularity: artist.playcount,\n      images: [{ url: artist.image[2]['#text'] }], // Using the medium-sized image\n    }));\n  } catch (error) {\n    console.error('Failed to fetch Last.FM top artists', error);\n    return [];\n  }\n};\n\nconst getLastFmTrackDetails = async (trackId) => {\n  try {\n    const response = await axios.get('https://ws.audioscrobbler.com/2.0/', {\n      params: {\n        method: 'track.getInfo',\n        api_key: lastFmApiKey,\n        mbid: trackId,\n        format: 'json'\n      }\n    });\n    return response.data.track;\n  } catch (error) {\n    console.error('Failed to fetch Last.FM track details', error);\n    return null;\n  }\n};\n\nconst getLastFmTrackTags = async (artist, track) => {\n  try {\n    const response = await axios.get('https://ws.audioscrobbler.com/2.0/', {\n      params: {\n        method: 'track.getTopTags',\n        api_key: lastFmApiKey,\n        artist: artist,\n        track: track,\n        format: 'json'\n      }\n    });\n    return response.data.toptags.tag.map(tag => tag.name);\n  } catch (error) {\n    console.error('Failed to fetch Last.FM track tags', error);\n    return [];\n  }\n};\n\nconst getLastFmArtistDetails = async (artist) => {\n  try {\n    const response = await axios.get('https://ws.audioscrobbler.com/2.0/', {\n      params: {\n        method: 'artist.getInfo',\n        api_key: lastFmApiKey,\n        artist: artist,\n        format: 'json'\n      }\n    });\n    const artistData = response.data.artist;\n    return {\n      ...artistData,\n      images: artistData.image.map(img => ({ url: img['#text'] }))\n    };\n  } catch (error) {\n    console.error('Failed to fetch Last.FM artist details', error);\n    return null;\n  }\n};\n\nexport { getLastFmTopTracks, getLastFmTopArtists, getLastFmTrackDetails, getLastFmArtistDetails, getLastFmTrackTags };\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}