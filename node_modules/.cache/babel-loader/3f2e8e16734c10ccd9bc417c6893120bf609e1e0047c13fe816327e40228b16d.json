{"ast":null,"code":"import axios from'axios';const clientId='7c6b8a3ea0e3406b9d8e5974be8b442b';const clientSecret='49aa02d0a85249279ae8ab73bbef28f5';const lastFmApiKey='28c425ac5fe3a7288e17efe8d7f9f82c';let spotifyToken=null;let tokenExpiry=null;const lastFmCache={};const getSpotifyToken=async()=>{if(spotifyToken&&tokenExpiry&&tokenExpiry>Date.now()){return spotifyToken;}const response=await axios.post('https://accounts.spotify.com/api/token',null,{headers:{'Content-Type':'application/x-www-form-urlencoded','Authorization':\"Basic \".concat(btoa(\"\".concat(clientId,\":\").concat(clientSecret)))},params:{grant_type:'client_credentials'}});spotifyToken=response.data.access_token;tokenExpiry=Date.now()+response.data.expires_in*1000;return spotifyToken;};const getSpotifyTopTracks=async()=>{const token=await getSpotifyToken();const response=await axios.get('https://api.spotify.com/v1/playlists/37i9dQZEVXbMDoHDwVN2tF/tracks',{headers:{'Authorization':\"Bearer \".concat(token)},params:{market:'US',limit:100}});return response.data.items.map(item=>{var _item$track$album$ima;return{id:item.track.id,name:item.track.name,artist:item.track.artists[0].name,artistId:item.track.artists[0].id,image:((_item$track$album$ima=item.track.album.images[1])===null||_item$track$album$ima===void 0?void 0:_item$track$album$ima.url)||''};});};const getTrackDetails=async trackId=>{const token=await getSpotifyToken();const response=await axios.get(\"https://api.spotify.com/v1/tracks/\".concat(trackId),{headers:{'Authorization':\"Bearer \".concat(token)}});return response.data;};const getArtistDetails=async artistId=>{const token=await getSpotifyToken();const response=await axios.get(\"https://api.spotify.com/v1/artists/\".concat(artistId),{headers:{'Authorization':\"Bearer \".concat(token)}});return response.data;};const getLastFmStreams=async(track,artist)=>{const cacheKey=\"\".concat(track,\"-\").concat(artist);if(lastFmCache[cacheKey]){return lastFmCache[cacheKey];}try{const response=await axios.get('https://ws.audioscrobbler.com/2.0/',{params:{method:'track.getInfo',api_key:lastFmApiKey,artist:artist,track:track,format:'json'}});console.log('Last.fm response:',response.data);if(response.data&&response.data.track){lastFmCache[cacheKey]=response.data.track.playcount;return response.data.track.playcount;}}catch(err){console.error('Failed to fetch Last.fm streams',err);}return'N/A';};export{getSpotifyTopTracks,getTrackDetails,getArtistDetails,getLastFmStreams};","map":{"version":3,"names":["axios","clientId","clientSecret","lastFmApiKey","spotifyToken","tokenExpiry","lastFmCache","getSpotifyToken","Date","now","response","post","headers","concat","btoa","params","grant_type","data","access_token","expires_in","getSpotifyTopTracks","token","get","market","limit","items","map","item","_item$track$album$ima","id","track","name","artist","artists","artistId","image","album","images","url","getTrackDetails","trackId","getArtistDetails","getLastFmStreams","cacheKey","method","api_key","format","console","log","playcount","err","error"],"sources":["/Users/peter/Documents/SUMMER 2024/SEG3125/tunescout/src/components/API.js"],"sourcesContent":["import axios from 'axios';\n\nconst clientId = '7c6b8a3ea0e3406b9d8e5974be8b442b';\nconst clientSecret = '49aa02d0a85249279ae8ab73bbef28f5';\nconst lastFmApiKey = '28c425ac5fe3a7288e17efe8d7f9f82c';\n\nlet spotifyToken = null;\nlet tokenExpiry = null;\nconst lastFmCache = {};\n\nconst getSpotifyToken = async () => {\n  if (spotifyToken && tokenExpiry && tokenExpiry > Date.now()) {\n    return spotifyToken;\n  }\n\n  const response = await axios.post('https://accounts.spotify.com/api/token', null, {\n    headers: {\n      'Content-Type': 'application/x-www-form-urlencoded',\n      'Authorization': `Basic ${btoa(`${clientId}:${clientSecret}`)}`\n    },\n    params: {\n      grant_type: 'client_credentials'\n    }\n  });\n\n  spotifyToken = response.data.access_token;\n  tokenExpiry = Date.now() + response.data.expires_in * 1000;\n  return spotifyToken;\n};\n\nconst getSpotifyTopTracks = async () => {\n  const token = await getSpotifyToken();\n  const response = await axios.get('https://api.spotify.com/v1/playlists/37i9dQZEVXbMDoHDwVN2tF/tracks', {\n    headers: {\n      'Authorization': `Bearer ${token}`\n    },\n    params: {\n      market: 'US',\n      limit: 100\n    }\n  });\n\n  return response.data.items.map(item => ({\n    id: item.track.id,\n    name: item.track.name,\n    artist: item.track.artists[0].name,\n    artistId: item.track.artists[0].id,\n    image: item.track.album.images[1]?.url || '',\n  }));\n};\n\nconst getTrackDetails = async (trackId) => {\n  const token = await getSpotifyToken();\n  const response = await axios.get(`https://api.spotify.com/v1/tracks/${trackId}`, {\n    headers: {\n      'Authorization': `Bearer ${token}`\n    }\n  });\n\n  return response.data;\n};\n\nconst getArtistDetails = async (artistId) => {\n  const token = await getSpotifyToken();\n  const response = await axios.get(`https://api.spotify.com/v1/artists/${artistId}`, {\n    headers: {\n      'Authorization': `Bearer ${token}`\n    }\n  });\n\n  return response.data;\n};\n\nconst getLastFmStreams = async (track, artist) => {\n  const cacheKey = `${track}-${artist}`;\n  if (lastFmCache[cacheKey]) {\n    return lastFmCache[cacheKey];\n  }\n\n  try {\n    const response = await axios.get('https://ws.audioscrobbler.com/2.0/', {\n      params: {\n        method: 'track.getInfo',\n        api_key: lastFmApiKey,\n        artist: artist,\n        track: track,\n        format: 'json'\n      }\n    });\n    console.log('Last.fm response:', response.data);\n    if (response.data && response.data.track) {\n      lastFmCache[cacheKey] = response.data.track.playcount;\n      return response.data.track.playcount;\n    }\n  } catch (err) {\n    console.error('Failed to fetch Last.fm streams', err);\n  }\n  return 'N/A';\n};\n\nexport { getSpotifyTopTracks, getTrackDetails, getArtistDetails, getLastFmStreams };\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}